<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to Premium | VR Street Art Gallery</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'gallery-dark': '#0a0a0a',
                        'gallery-gray': '#1a1a1a',
                        'gallery-accent': '#ff3366',
                        'gallery-purple': '#8b5cf6',
                        'gallery-cyan': '#06b6d4',
                    }
                }
            }
        }
    </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        h1, h2, h3 { font-family: 'Space Grotesk', sans-serif; }
        .gradient-text {
            background: linear-gradient(135deg, #ff3366 0%, #8b5cf6 50%, #06b6d4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            top: -10px;
            animation: confetti 3s ease-out forwards;
        }
        @keyframes checkmark {
            0% { stroke-dashoffset: 100; }
            100% { stroke-dashoffset: 0; }
        }
        .checkmark {
            stroke-dasharray: 100;
            stroke-dashoffset: 100;
            animation: checkmark 0.8s ease-out 0.3s forwards;
        }
        @keyframes scale-in {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .scale-in {
            animation: scale-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gallery-dark text-white min-h-screen flex items-center justify-center">

    <div class="max-w-lg mx-auto px-6 py-16 text-center">
        <!-- Success Icon -->
        <div class="w-24 h-24 mx-auto mb-8 rounded-full bg-green-500/20 flex items-center justify-center scale-in">
            <svg class="w-12 h-12 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path class="checkmark" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
            </svg>
        </div>

        <!-- Heading -->
        <h1 class="text-4xl md:text-5xl font-bold mb-4">
            Welcome to <span class="gradient-text" id="tier-name">Premium</span>!
        </h1>

        <p class="text-xl text-gray-400 mb-8">
            Your subscription is now active. You're ready to experience the full VR Street Art Gallery.
        </p>

        <!-- What's Next -->
        <div class="bg-gallery-gray border border-white/10 rounded-2xl p-6 mb-8 text-left">
            <h2 class="text-lg font-semibold mb-4">What's next?</h2>
            <ul class="space-y-3">
                <li class="flex items-start gap-3">
                    <div class="w-6 h-6 rounded-full bg-gallery-accent/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                        <span class="text-gallery-accent text-sm">1</span>
                    </div>
                    <div>
                        <div class="font-medium">Download the App</div>
                        <div class="text-sm text-gray-500">Available on Meta Quest and PC VR</div>
                    </div>
                </li>
                <li class="flex items-start gap-3">
                    <div class="w-6 h-6 rounded-full bg-gallery-purple/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                        <span class="text-gallery-purple text-sm">2</span>
                    </div>
                    <div>
                        <div class="font-medium">Create Your Avatar</div>
                        <div class="text-sm text-gray-500">Customize your look with unlimited options</div>
                    </div>
                </li>
                <li class="flex items-start gap-3">
                    <div class="w-6 h-6 rounded-full bg-gallery-cyan/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                        <span class="text-gallery-cyan text-sm">3</span>
                    </div>
                    <div>
                        <div class="font-medium">Explore the Gallery</div>
                        <div class="text-sm text-gray-500">Walk through and discover amazing street art</div>
                    </div>
                </li>
            </ul>
        </div>

        <!-- Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
            <a href="/" class="px-8 py-4 bg-gallery-accent hover:bg-gallery-accent/90 rounded-full font-semibold transition">
                Back to Home
            </a>
            <a href="#" id="manage-btn" class="px-8 py-4 bg-gallery-gray hover:bg-white/10 border border-white/10 rounded-full font-semibold transition">
                Manage Subscription
            </a>
        </div>

        <!-- Receipt -->
        <p class="text-sm text-gray-500 mt-8">
            A receipt has been sent to your email. You can manage your subscription anytime.
        </p>
    </div>

    <!-- Confetti -->
    <script>
        // Create confetti
        const colors = ['#ff3366', '#8b5cf6', '#06b6d4', '#22c55e', '#f59e0b'];
        for (let i = 0; i < 50; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animationDelay = Math.random() * 2 + 's';
            confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
            document.body.appendChild(confetti);
        }

        // Remove confetti after animation
        setTimeout(() => {
            document.querySelectorAll('.confetti').forEach(c => c.remove());
        }, 5000);

        // Get tier from URL params
        const urlParams = new URLSearchParams(window.location.search);
        const tier = urlParams.get('tier') || 'Premium';
        document.getElementById('tier-name').textContent = tier.charAt(0).toUpperCase() + tier.slice(1);

        // ============================================
        // CUSTOMER PORTAL
        // ============================================
        // Supabase config (same as index.html)
        const SUPABASE_URL = 'YOUR_SUPABASE_URL';
        const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY';

        document.getElementById('manage-btn').addEventListener('click', async (e) => {
            e.preventDefault();

            const btn = e.target;
            btn.disabled = true;
            btn.textContent = 'Loading...';

            try {
                // If Supabase not configured, show message
                if (SUPABASE_URL === 'YOUR_SUPABASE_URL') {
                    alert('Subscription management will be available once you configure Supabase.');
                    btn.disabled = false;
                    btn.textContent = 'Manage Subscription';
                    return;
                }

                // Initialize Supabase
                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                const { data: { session } } = await supabase.auth.getSession();

                if (!session) {
                    alert('Please sign in to manage your subscription.');
                    window.location.href = '/';
                    return;
                }

                // Call customer portal Edge Function
                const response = await fetch(`${SUPABASE_URL}/functions/v1/customer-portal`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${session.access_token}`
                    },
                    body: JSON.stringify({
                        returnUrl: window.location.origin
                    })
                });

                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                // Redirect to Stripe Customer Portal
                if (data.url) {
                    window.location.href = data.url;
                }
            } catch (err) {
                console.error('Portal error:', err);
                alert('Unable to open subscription portal. Please try again.');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Manage Subscription';
            }
        });
    </script>
</body>
</html>
